<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MuSHR System Overview - MuSHR: The UW Open Racecar Project</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="icon" href="https://mushr.io/favicon.png">

  
  
  <link rel="stylesheet" href="/css/style.min.c2afc1cc4aaac1ae8d3c6236f926d4fa21d34d80395cf9445c90f953db695e44.css">
  

  

</head>

<body class='page page-tutorials-single'>
  <div id="main-menu-mobile" class="main-menu-mobile">
  <ul>
    
    
    <li class="menu-item-quickstart">
      <a href="/tutorials/quickstart/">
        
        <span>Quickstart</span>
      </a>
    </li>
    
    <li class="menu-item-about">
      <a href="/about/">
        
        <span>About</span>
      </a>
    </li>
    
    <li class="menu-item-docs">
      <a href="https://github.com/prl-mushr/mushr#component-documentation">
        
        <span>Docs</span>
      </a>
    </li>
    
    <li class="menu-item-hardware">
      <a href="/hardware/">
        
        <span>Hardware</span>
      </a>
    </li>
    
    <li class="menu-item-tutorials">
      <a href="/tutorials/">
        
        <span>Tutorials</span>
      </a>
    </li>
    
    <li class="menu-item-press">
      <a href="/press/">
        
        <span>Press</span>
      </a>
    </li>
    
    <li class="menu-item-team">
      <a href="https://personalrobotics.cs.washington.edu/people/">
        
        <span>Team</span>
      </a>
    </li>
    
    <li class="menu-item-community forum">
      <a href="https://spectrum.chat/mushr">
        
        <span>Community Forum</span>
      </a>
    </li>
    
    <li class="menu-item-contact">
      <a href="/contact/">
        
        <span>Contact</span>
      </a>
    </li>
    
  </ul>
</div>
  <div class="wrapper">
    <div class='header'>
  <div class="container">
    <div class="logo">
      <a href="https://mushr.io/"><img alt="Figurit Homepage" src="https://mushr.io/imgs/mushr-logo.svg" /></a>
    </div>
    <div class="logo-mobile">
      <a href="https://mushr.io/"><img alt="Figurit Homepage" src="https://mushr.io/imgs/mushr-logo.svg" /></a>
    </div>
    <div id="main-menu" class="main-menu">
  <ul>
    
    
    <li class="menu-item-quickstart">
      <a href="/tutorials/quickstart/">
        
        <span>Quickstart</span>
      </a>
    </li>
    
    <li class="menu-item-about">
      <a href="/about/">
        
        <span>About</span>
      </a>
    </li>
    
    <li class="menu-item-docs">
      <a href="https://github.com/prl-mushr/mushr#component-documentation">
        
        <span>Docs</span>
      </a>
    </li>
    
    <li class="menu-item-hardware">
      <a href="/hardware/">
        
        <span>Hardware</span>
      </a>
    </li>
    
    <li class="menu-item-tutorials">
      <a href="/tutorials/">
        
        <span>Tutorials</span>
      </a>
    </li>
    
    <li class="menu-item-press">
      <a href="/press/">
        
        <span>Press</span>
      </a>
    </li>
    
    <li class="menu-item-team">
      <a href="https://personalrobotics.cs.washington.edu/people/">
        
        <span>Team</span>
      </a>
    </li>
    
    <li class="menu-item-community forum">
      <a href="https://spectrum.chat/mushr">
        
        <span>Community Forum</span>
      </a>
    </li>
    
    <li class="menu-item-contact">
      <a href="/contact/">
        
        <span>Contact</span>
      </a>
    </li>
    
  </ul>
</div>

    <button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" role="presentation" aria-label="mobile menu trigger">
  <span class="hamburger-box">
    <span class="hamburger-inner"></span>
  </span>
</button>
  </div>
</div>
    
<script>
  document.getElementsByClassName("menu-item-quickstart")[1].classList.add('active')
</script>
<div class="container pb-6 pt-6 pt-md-10 pb-md-10">
  <div class="row justify-content-start">
    <div class="col-12 col-md-8">
      <div class="tutorial tutorial-single">
        <h1 class="title">MuSHR System Overview</h1>
        <div class="content"> 
          
          <p>Basic components of the car and their associated software counterparts.</p> 
          
          <h4 class="properties">Intermediate Tutorial | Expected duration is 15 minutes</h4> 
          
          <h2> By: <a href=https://www.mattschmittle.com/>Matt Schmittle</a></h2>                              
<h3 id="introduction">Introduction</h3>
<p>This tutorial is largely informative and intended to read more like a manual. We will cover all the major software and hardware components of the car.</p>
<h3 id="goal">Goal</h3>
<p>To be able to identify and understand the purpose of the major software and hardware components of the car.</p>
<h3 id="requirements">Requirements</h3>
<p>A car that you can connect to if you wish to follow along.</p>
<h2 id="hardware-overview">Hardware Overview</h2>
<p>This section will cover an overview of the physical racecar Below is a diagram of the physical racecar components.</p>
<figure>
    <img src="/tutorials/overview/hardware_overview.png"
         alt="This diagram shows all the components and their data &amp;amp; power connections." width="600"/> <figcaption>
            <p>This diagram shows all the components and their data &amp; power connections.</p>
        </figcaption>
</figure>

<ul>
<li><strong>Chasis (Redcat Racing Blackout SC 1/10) :</strong> The car chasis. It has adjustable 4x4 suspension and non-flat tires. It is also used for mounting things to it, including the housing which contains the computer and sensors.</li>
<li><strong>Computer (Jetson Nano):</strong> This the computer that runs the software on the car. You can connect to the computer in 3 ways primarily: ssh through local network to static IP, connecting to car's network and using ssh, or plugging a monitor, keyboard, and mouse into the computer directly.</li>
<li><strong>Motor (Jrelecs F540 3930KV):</strong>  The single DC motor that powers all four wheels. The motor makes the car move and is controlled by the VESC.</li>
<li><strong>Servo (ZOSKAY 1X DS3218):</strong> A servo is another type of motor but is better at going to specific angles along its rotation than rotating continuously. The servo's job is to steer the front wheels by taking in steering angle commands. The servo is also controlled by the VESC.</li>
<li><strong>VESC (Turnigy SK8-ESC):</strong> The VESC is responsible for taking high level control commands like steering angle and velocity and converting that to power/angle commands for the motor/servo. The VESC has an associated ROS node. This node takes your ROS <code>ackermann_msgs/AckermannDriveStamped</code> message and converts that to <code>VescStateStamped</code> (power), and <code>Float64</code> (steering angle) messages. These messages are something the physical VESC can use to control the motor and servo.</li>
<li><strong>NiMH Battery (Redcat Racing HX-5000MH-B):</strong> There are 2 batteries. One to power the motor and in turn the VESC (because the motor power flows through the VESC). And a second to power the computer and sensors. Many of the issues (particularly with the VESC) can stem from one of these batteries having a low battery, so it is good to check them regularly.</li>
<li><strong>Power Converter (DZS Elec LM2596):</strong> This power converter converts the higher voltage of the battery to the necessary 5V max for the computer.</li>
<li><strong>RGBD Camera (Realsense D435i):</strong> This Intel Realsense camera can publish both rgb and depth. It has a associated node so you can just subscribe to the topic to use the images! OpenCV even has a function for converting ROS <code>Image</code> messages to something OpenCV can use. Note depth cameras are different from stereo cameras (how humans do it). They both provide the same output, but depth cameras project a IR pattern and use a IR camera to see the deformation of that pattern to compute depth. Depth cameras will also sometimes use stereo in addition to make their measurements more accurate. It publishes to the <code>/camera</code> topics. This camera can also publish IMU measurments, but they currently are not being used.</li>
<li><strong>Laser Scanner (YDLIDAR X4):</strong> This 360 degree sensor works by having a 1D laser range finder spin around. With each distance reading their is a associated angle the range finder was at. It publishes an array of distance and angle measurements to the <code>/scan</code> topic.</li>
<li><strong>Wireless Controller (Logitech F710):</strong> This provides controls to the cars! It doesn't just have to be use for teleop it can be used by your programs for most anything. It publishes on the <code>/joy</code> topic.</li>
<li><strong>Bumber Switch (Vex Bumper Switch):</strong> This is a button on the front of the car that you can use to indicate a collision. It publishes a binary signal to <strong>/push_button_state</strong>.</li>
<li><strong>Micro SD Card:</strong> Storage for the OS and any logs. What's great about this is if you want to switch cars you can simply switch SD cards.</li>
</ul>
<h2 id="software-components">Software Components</h2>
<p>Now that we have a better understanding of the hardware components let's checkout the software components and see how it all ties together.
On the car go to your catkin workspace<br>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"> <span class="nb">cd</span> ~/catkin_ws/</code></pre></div></p>
<p>and list the directories</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ls
build  devel  src</code></pre></div>
<p>So what we have is 3 directories. <code>build</code> is where code is compiled to. <code>devel</code> has setup files for your environment. The most important thing about <code>devel</code> is that it contains <code>setup.**</code> which sets up environment variables and paths amongst other things.
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">robot@digger:~/catkin_ws/devel$ ls
bin  env.sh  include  lib  setup.bash  setup.sh  _setup_util.py  setup.zsh  share
 </code></pre></div></p>
<p>So <code>setup.**</code> (&ldquo;<code>**</code>&rdquo; because you can run .bashrc, .sh, or .zsh and get the same effect) sets up ROS environment variables and paths. So if you ever see an error that says that it can't find a package, or that roscore isn't a command, it is because you have not sourced your <code>setup.**</code> like so
<code>source ~/catkin_ws/devel/setup.bash</code>
We usually prevent this by putting the above in your <code>~/.bashrc</code> a file that is run everytime you log in.
So now if you change directories to <code>~/catkin_ws/src/</code> you will see all the ros packages. When you want to make new ROS software you make a package and you put it here. Why? Because when you run <code>catkin_make</code> it looks in this directory for the packages it needs to build. <code>catkin_make</code> needs to be run in the <code>~/catkin_ws/</code> directory and should be run after every update in code. Although, since python is an interpreted language, we do not have to run <code>catkin_make</code> everytime we edit code, but in C++ we would.</p>
<p>Alright, now that we have a high level view of our workspace let's checkout the system components. Each package (located in <code>src</code>) creates ROS nodes. This tutorial will not dive into the details of how ROS works but this <a href="https://robohub.org/ros-101-intro-to-the-robot-operating-system/">post</a> gives a good overview with diagrams. Below is a simplified diagram of the system at a high level:</p>
<figure>
    <img src="/tutorials/overview/software_overview.png"
         alt="The full MuSHR stack with each ROS node as a box and each line as a ROS topic." width="980"/> <figcaption>
            <p>The full MuSHR stack with each ROS node as a box and each line as a ROS topic.</p>
        </figcaption>
</figure>

<p>Let's unpack this, starting from the top. The sensor nodes take the raw input, do some processing, and  convert it to ros friendly topics. The map server converts a <code>.yaml</code> map file to a ros topic. Your controller (orange) takes in sensor topics coming in from the each sensors&rsquo; ros node and the map. It then outputs some command to drive the car. That command is put into the mux which listens on multiple <code>/mux/ackermann_cmd_mux/input</code> channels and selects the highest priority. <code>*/input/default</code> is a zero throttle/steering command that is passed whenever your controller and teleop are not publishing.
Currently, MuSHR does not have a explicit safety controller publishing to the <code>*/input/safety</code> topic. The mux priorities can be found <code>mushr_base/ackermann_cmd_mux/param/mux.yaml</code> and they are listed in order of priority below.</p>
<pre><code>1. Safety  
2. Teleop  
3. Navigation  
4. Default  
</code></pre>
<p>Once the highest priority command is output it goes to the VESC. The VESC smoothes the command by clipping the min/max of the steering/throttle so we don't try to turn the wheels 180 degrees for example. It then provides that to the vesc driver which directly controls the motors.</p>
<p>These components are in the following locations all within <code>~/catkin_ws/src/mushr/</code> if you want to check them out for more details:</p>
<ul>
<li>MUX:  <code>mushr_base/ackermann_cmd_mux</code></li>
<li>VESC: <code>mushr_base/vesc</code>
<ul>
<li><code>vesc</code> describes the metapackage</li>
<li><code>vesc_main</code> contains configuration files and launch files for running the vesc</li>
<li><code>vesc_ackermann</code> contains vesc odom info (not depicted in diagram)</li>
<li><code>vesc_driver</code> is the last piece of the diagram connecting the physical vesc with the computer. It also contains the throttle interpolator.</li>
<li><code>vesc_msgs</code> describes the VescState message</li>
</ul>
</li>
<li>Teleop: <code>mushr_base/mushr_base/src/joy_teleop.py</code></li>
<li>Lidar: <code>mushr_hardware/ydlidar</code></li>
<li>Button: <code>mushr_hardware/push_button_utils</code></li>
<li>Camera: <code>mushr_hardware/realsense</code></li>
<li>Map: <code>mushr_base/mushr_base/launch/includes/map_server.launch</code></li>
</ul>
<p>Now you should have a grasp of the basic hardware and software components of MuSHR platform! Please <a href="/contact">contact us</a> with any questions or feedback about your experience using the MuSHR system and tutorials.</p>

        </div>
      </div>
    </div>
  </div>
</div>
<div class="strip strip-primary-gradient-top-bottom">
  <div class="container pt-3 pb-3 pt-md-6 pb-md-3 px-2">
    <div class="row justify-content-left citation-row">
        <h1 id="citation">Citation</h1>
        <p>If you plan to use any part of the the MuSHR platform, including tutorials, codebase, or hardware instructions for a project or paper, please cite 
        <em><a href="https://arxiv.org/abs/1908.08031">MuSHR: A Low-Cost,
        Open-Source Robotic Racecar for Education and Research
        </a></em>:</p></font>
        <div class="highlight"><pre class="chroma">@article{srinivasa2019mushr,
 title={{M}u{SHR}: {A} Low-Cost, Open-Source Robotic Racecar for Education and Research},
 author={Srinivasa, Siddhartha S. and Lancaster, Patrick and Michalove, Johan and Schmittle, Matt and Summers, Colin and Rockett, Matthew and Smith, Joshua R. and Chouhury, Sanjiban and Mavrogiannis, Christoforos and Sadeghi, Fereshteh},
 journal={CoRR},
 volume={abs/1908.08031},
 year={2019}
}
</pre></div>
        <p><br></p>
    </div>
  </div>
</div>


  </div>

  <div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="footer-inner">
          <h3 class="footer-title">MuSHR: The UW Open Racecar Project</h3>
          <ul>
            
            
            <li class="menu-item-home">
              <a href="/">
                Home
              </a>
            </li>
            
            <li class="menu-item-community forum">
              <a href="https://spectrum.chat/mushr">
                Community Forum
              </a>
            </li>
            
            <li class="menu-item-contact">
              <a href="/contact/">
                Contact
              </a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
  <div class="sub-footer">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="sub-footer-inner">
          <ul>
            <li><strong>Email: </strong><a href="mailto:">
                </a></li>
          </ul>
          <ul>
            <li class="prl"><a href="https://personalrobotics.cs.washington.edu/">Made with <font color="#FF1690">♥</font> at the Personal Robotics Lab</a></li>
          </ul>
          <ul>
            <li class="prl">Website by <a href="http://johanam.com/"><font color="#36CDC4">Johan</font></a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

  

  




  <script type="text/javascript" src="/js/services.min.96db5a4d9a7ea2d1759fd6847940367b5207c4ef5686df932179e04aefccdf37.js"></script>
  


  
  <script type="text/javascript" src="/js/scripts.min.bf1e1f7ae8e03db5f012356e825843facdff51c0a559cb0d27fe2bbe1db405c2.js"></script>
  

  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-146151202-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());
  gtag('config', 'UA-146151202-1');
</script>




</body>

</html>